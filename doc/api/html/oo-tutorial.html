<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>HPCloud-PHP: Tutorial: Using HPCloud-PHP</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="hpcloud-logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">HPCloud-PHP
   &#160;<span id="projectnumber">-UNSTABLE%</span>
   </div>
   <div id="projectbrief">PHP bindings for HPCloud and OpenStack services.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('oo-tutorial.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: Using HPCloud-PHP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>HPCloud-PHP provides PHP language bindings for the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> APIs. <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> is an OpenStack-based cloud service offering a wide (and ever-expanding) variety of services.</p>
<p>In this tutorial, we will walk through the process of creating a simple tool that interacts with HP Cloud's Object Storage. The emphasis in this article is on getting started and learning the concepts, not building a polished product.</p>
<p><b>This tutorial focuses on the object-oriented API.</b> The other way to work with this library is through the stream wrapper. That topic is covered in <a class="el" href="streams-tutorial.html">another tutorial</a>.</p>
<h2>Pre-flight Check</h2>
<p>HPCloud-PHP has been developed to require PHP 5.3 or later. You are strongly encouraged to also install the CURL PHP extension. Many distributions of PHP come with this enabled. Sometimes, though, you may need to do something like <code>apt-get php5-curl</code> or similar. (Don't take our word for it -- check your system's documentation.)</p>
<p>You can check for both of these conditions by checking the output of <code>php --info</code> (on the commandline) or <code>&lt;?php phpinfo(); ?&gt;</code>.</p>
<h3>Check the pilot, too!</h3>
<p>In our pre-flight check, we would be remiss if we didn't point out that there are some requirements for the pilot (that's you), too.</p>
<p>The <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> library is composed of two parts:</p>
<ol type="1">
<li>The Object-Oriented part, which is the subject of this tutorial.</li>
<li>The Stream Wrapper, which is the subject of another tutorial.</li>
</ol>
<p>The object-oriented library makes ample use of PHP namespaces. If you've never seen these before, they look like this:</p>
<div class="fragment"><pre class="fragment">&lt;?php
\HPCloud\Storage\ObjectStorage\RemoteObject
?&gt;
</pre></div><p>The namespace above is read like this: "The RemoteObject class is part of the ObjectStorage package in the Storage package in the base <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> package." Those familiar with Java, Python, and other languages will recognize this way of talking (though the backslash is an unfortunate symbol choice).</p>
<p>For our library, we followed the recommendation of SPR-0, which means that the class above can be found in the file at:</p>
<div class="fragment"><pre class="fragment">src/HPCloud/Storage/ObjectStorage/RemoteObject.php
</pre></div><p>The pattern of matching namespace to file name should (we hope) make it easier for you to navigate our code.</p>
<p>If this namespace stuff continues to confuse you, you may want to take a look at <a href="http://us3.php.net/manual/en/language.namespaces.php">the PHP documentation</a>, or you may just prefer to keep on reading and learn by example. We don't do anything really fancy with namespaces.</p>
<p>**In this document, we sometimes replace the backslash () with double colons (<code>::</code>) so that links are automatically generated.** So <code>\<a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a>\Bootstrap</code> may appear as <a class="el" href="class_h_p_cloud_1_1_bootstrap.html" title="Bootstrapping services.">HPCloud::Bootstrap</a>. The reason for this is <a class="el" href="styleguide.html">explained elsewhere</a>.</p>
<h2>Step 1: Getting the Library</h2>
<p>You can get the HPCloud-PHP library at the <a href="https://github.com/hpcloud">HPCloud GitHub Repository</a>. The latest code is always available there.</p>
<p>The project also uses <a href="http://packagist.org/">Composer</a>, and this is the best method for adding HPCloud-PHP to your PHP project.</p>
<p>For our example, we will assume that the library is accessible in the default include path, so the following line will include the <code><a class="el" href="_bootstrap_8php.html" title="HP Cloud configuration.">Bootstrap.php</a></code> file:</p>
<div class="fragment"><pre class="fragment">include <span class="stringliteral">&#39;HPCloud/Bootstrap.php&#39;</span>;
</pre></div><h2>Step 2: Bootstrap the Library</h2>
<p>The first thing to do in your application is make sure the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> library is bootstrapped. When we say "bootstrap", what we really mean is letting the library initialize itself.</p>
<p>Bootstrapping does not always involve any manual interaction on your part. If you are using an SPR-0 autoloader that knows of the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> directory, that is enough for the system to initialize itself.</p>
<p>Sometimes, though, you will need to bootstrap <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> in your own code, and this is done as follows:</p>
<div class="fragment"><pre class="fragment">&lt;?php
require_once <span class="stringliteral">&#39;HPCloud/Bootstrap.php&#39;</span>;

use \HPCloud\Bootstrap;
use \HPCloud\Services\IdentityServices;
use \HPCloud\Storage\ObjectStorage;
use \HPCloud\Storage\ObjectStorage\Object;

<a class="code" href="class_h_p_cloud_1_1_bootstrap.html#afc845c2cef6046a452d2e4e98c8e9cb5" title="Add the autoloader to PHP&#39;s autoloader list.">\HPCloud\Bootstrap::useAutoloader</a>();
?&gt;
</pre></div><p>The first line should be self-explanatory: We require the main <code><a class="el" href="_bootstrap_8php.html" title="HP Cloud configuration.">Bootstrap.php</a></code> file (which contains the <code>Bootstrap</code> class).</p>
<p>After that, we declare a list of namespaced objects that we will use. This way we can refer to them by their short name, rather than by their fully qualified name.</p>
<p>The last line initializes the built-in <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> autoloader. What does this mean? It means that this is the only <code>require</code> or <code>include</code> statement you need in your code. The library does the rest of the including for you, on demand, in a performance-sensitive way.</p>
<p>There are some other fancy things that <a class="el" href="class_h_p_cloud_1_1_bootstrap.html" title="Bootstrapping services.">HPCloud::Bootstrap</a> can do for you. Most notably, you can pass configuration parameters into it. But for the time being, we are good to go.</p>
<p>Our library is boostrapped. Next up: Let's connect to our account.</p>
<h2>Step 3: Connecting</h2>
<p>Our programming goal, in this tutorial, is to interact with the Object Storage service on HP Cloud. (Object Storage is, for all intents and purposes, basically a service for storing files in the cloud.)</p>
<p>But before we can interact directly with Object Storage, we need to authenticate to the system. And to do this, we need the following four pieces of information:</p>
<ul>
<li>Account ID: The account number.</li>
<li>Secret key: The shared secret that, when paired with account number, authenticates the client.</li>
<li>Tenant ID: An identifier that maps an account to a set of services. (In theory at least, one account can have multiple tenant IDs, and one tenant ID can be linked to multiple accounts.)</li>
<li>Endpoint URL: The URL to the Identity Services endpoint at <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a>.</li>
</ul>
<p>Before you issue a forlorn sigh, envisioning some laborious task, let us point out that all of this information is available in one place, Log into <a href="https://manage.hpcloud.com">the management console</a> and go to the <code>API Keys</code> page. It's all there.</p>
<h3>Identity Services</h3>
<p>The <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> is composed of numerous services. There's the Compute service, the Object Storage service, the CDN service... and so on.</p>
<p>Authenticating separately to each of these would be a collosal waste of network resources. And behind the scenes, account management would be difficult on the server side.</p>
<p>That's where Identity Services comes in. It is a central service that handles all things authorization and authentication related. Rouughly, it works as follows:</p>
<ul>
<li>The client sends an authentication request</li>
<li>If it fails, the service returns an error</li>
<li>If authentication succeeds, the service returns a time-sensitive token (basically a shared secret) and a "service catalog"</li>
</ul>
<p>The <em>token</em> is valid for some fixed period of time (say, 30 minutes), during which time it can be used for every other service. Each request to an <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> service should send (along with other info) the token. The remote service then validates the token with identity services, saving our app the trouble of making another round trip.</p>
<p>The <em>service catalog</em> lists all of the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> services that the present account can access.</p>
<h3>Authenticating</h3>
<p>With that little bit of theory behind us, we can now go about authenticating.</p>
<div class="fragment"><pre class="fragment">&lt;?php
<a class="code" href="oo-tutorial-code_8php.html#a19ec872392da5d6131f9ad03b6c98339">$account</a> = <span class="stringliteral">&#39;ADD ACCOUNT HERE&#39;</span>;
<a class="code" href="oo-tutorial-code_8php.html#aa60b0284e0dfa2463495481cf11e3cf4">$key</a> = <span class="stringliteral">&#39;ADD KEY HERE&#39;</span>;
<a class="code" href="oo-tutorial-code_8php.html#a26979ce90bf4105e2b0abbf108d64dec">$tenantId</a> = <span class="stringliteral">&#39;ADD TENANT ID HERE&#39;</span>;
<a class="code" href="oo-tutorial-code_8php.html#afb5204f7604df2f50a0058cb0e024875">$endpoint</a> = <span class="stringliteral">&#39;ADD ENDPOINT URL HERE&#39;</span>;

<a class="code" href="oo-tutorial-code_8php.html#a22e7639aa8522802ae6a98149f14a927">$idService</a> = new \HPCloud\Services\IdentityServices(<a class="code" href="oo-tutorial-code_8php.html#afb5204f7604df2f50a0058cb0e024875">$endpoint</a>);
<a class="code" href="oo-tutorial-code_8php.html#a00ae4fcafb1145f5e968bdf920f83e2e">$token</a> = <a class="code" href="oo-tutorial-code_8php.html#a22e7639aa8522802ae6a98149f14a927">$idService</a>-&gt;authenticateAsAccount($account, <a class="code" href="oo-tutorial-code_8php.html#aa60b0284e0dfa2463495481cf11e3cf4">$key</a>, <a class="code" href="oo-tutorial-code_8php.html#a26979ce90bf4105e2b0abbf108d64dec">$tenantId</a>);
?&gt;
</pre></div><p>Assuming the variables above have been set to include valid data, this script can connect to <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> and authenticate.</p>
<p>When we construct a new <a class="el" href="class_h_p_cloud_1_1_services_1_1_identity_services.html" title="IdentityServices provides authentication and authorization.">HPCloud::Services::IdentityServices</a> object, we must pass it the endpoint URL for <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> Identity Services. Typically, that URL will look something like this:</p>
<div class="fragment"><pre class="fragment">https://region-a.geo-1.identity.hpcloudsvc.com:35357
</pre></div><p>The <code>authenticateAsAccount()</code> method will authenticate to the Identity Services endpoint. For convenience, it returns the authorization token (<code>$token</code>), though we can also get the token from <code>$idService-&gt;token()</code>.</p>
<p>Note that the <code>IdentityServices</code> object may throw various exceptions (all subclasses of <a class="el" href="class_h_p_cloud_1_1_exception.html" title="The top-level HPCloud exception.">HPCloud::Exception</a>) during authentication. Failed authentication results in an <a class="el" href="class_h_p_cloud_1_1_transport_1_1_authorization_exception.html" title="Thrown when an access constraint is not met.">HPCloud::Transport::AuthorizationException</a>, while a network failure may result in an <a class="el" href="class_h_p_cloud_1_1_transport_1_1_server_exception.html" title="Represents an HTTP 500 error.">HPCloud::Transport::ServerException</a>.</p>
<p>Earlier, we talked about the service catalog. Once we've authenticated, we can get the service catalog from <code>$idService-&gt;serviceCatalog()</code>. It is an associative array, and you can get an idea of what it contains by dumping it with <code>var_dump()</code>, should you so desire.</p>
<p>At this point, we have what we need from Identity Services. It's time to look at Object Storage.</p>
<h3>IdentityServices in a Nushell</h3>
<p>Instances of <a class="el" href="class_h_p_cloud_1_1_services_1_1_identity_services.html" title="IdentityServices provides authentication and authorization.">HPCloud::Services::IdentityServices</a> are responsible for:</p>
<ul>
<li>Authentication</li>
<li>Accessing the service catalog</li>
<li>Accessing account info</li>
<li>Associating tenant IDs with accounts (advanced)</li>
</ul>
<h2>Step 4: Connecting to Object Storage</h2>
<p>The Object Storage system is concerned with two classes of things:</p>
<ul>
<li>An Object: A self-contained bundle of data (back in my day, we called them "files").</li>
<li>A Container: A storage container (bucket) for objects.</li>
</ul>
<p>Your object storage can have any number of containers, and each container can have any number of objects.</p>
<p>In the object model for the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> PHP library, a top-level object called <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage.html" title="Access to ObjectStorage (Swift).">HPCloud::Storage::ObjectStorage</a> provides access to the Object Storage service. In this step, we will be working with that object.</p>
<h3>Getting an ObjectStorage Instance</h3>
<p>Earlier, we created an <code>IdentityServices</code> instance called <code>$idService</code>. We will use that here to get the service catalog. Once we have the catalog, we can have a new <code>ObjectStorage</code> instance created for us, configured to talk to our account's Object Storage instance in the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a>. Along with the service catalog, we also need our token that shows the Object Storage endpoint that we have already authenticated to Identity Services. Earlier, we captured that value in the <code>$token</code> variable.</p>
<p>Now we can get a new <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage.html" title="Access to ObjectStorage (Swift).">HPCloud::Storage::ObjectStorage</a> instance:</p>
<div class="fragment"><pre class="fragment">&lt;?php
<a class="code" href="oo-tutorial-code_8php.html#ab30d2fd9b2fc63b1367117f70356e858">$catalog</a> = <a class="code" href="oo-tutorial-code_8php.html#a22e7639aa8522802ae6a98149f14a927">$idService</a>-&gt;serviceCatalog();

<a class="code" href="oo-tutorial-code_8php.html#a827b42f70d98e1bf51ff54dbbe771421">$store</a> = ObjectStorage::newFromServiceCatalog($catalog, <a class="code" href="oo-tutorial-code_8php.html#a00ae4fcafb1145f5e968bdf920f83e2e">$token</a>);
?&gt;
</pre></div><p>First we get the service catalog (<code>$catalog</code>), and then we use the <code>ObjectStorage::newFromServiceCatalog()</code> static method to create the new Object Storage instance.</p>
<p>The pattern of using a constructor-like static function is used throughout the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> PHP library. Inspired by Objective-C constructors and the Factory design pattern, it makes it possible for a single class to have multiple constructors.</p>
<p>In particular, many top-level classes provide a <code>newFromServiceCatalog()</code> constructor function, since these classes know how to construct instances from a service catalog, thus freeing the developer up from knowing the details of a service catalog entry.</p>
<p>Now we have an <code>ObjectStorage</code> instance that is already configured to talk to our <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> object storage service. Next, we can create a container.</p>
<h3>ObjectStorage in a Nutshell</h3>
<p>Instances of <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage.html" title="Access to ObjectStorage (Swift).">HPCloud::Storage::ObjectStorage</a> are responsbile for:</p>
<ul>
<li>Providing high-level information about the Object Storage service</li>
<li>Creating, deleting, loading, and listing Containers</li>
<li>Modifying Container ACLs</li>
<li>Attaching a <a class="el" href="class_h_p_cloud_1_1_storage_1_1_c_d_n.html" title="Provides CDN services for ObjectStorage.">HPCloud::Storage::CDN</a> service object to a Container (advanced)</li>
</ul>
<h2>Step 5: Adding a Container</h2>
<p>Before we can start putting objects (files) into our Object Storage service, we need a place to put them. An Object Storage service can hold numerous containers (and each container can have different access controls -- a topic we won't get into here).</p>
<p>Containers are represented in the library by the <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_container.html" title="A container in an ObjectStorage.">HPCloud::Storage::ObjectStorage::Container</a> class. And creating a container is done by a method on the <code>ObjectStorage</code> object that we created above:</p>
<div class="fragment"><pre class="fragment">&lt;?php
<a class="code" href="oo-tutorial-code_8php.html#a827b42f70d98e1bf51ff54dbbe771421">$store</a>-&gt;createContainer(<span class="stringliteral">&#39;Example&#39;</span>);
<a class="code" href="oo-tutorial-code_8php.html#ab97dd40df90f4ce6f0fce9091e7c7872">$container</a> = <a class="code" href="oo-tutorial-code_8php.html#a827b42f70d98e1bf51ff54dbbe771421">$store</a>-&gt;container(<span class="stringliteral">&#39;Example&#39;</span>);
?&gt;
</pre></div><p>Recall that <code>$store</code> is the name of our <code>ObjectStorage</code> instance. In the first of the two lines above, we create a new containe named <code>Example</code>. Then in the second line, we get that container.</p>
<p>Why is this two steps? The answer is that the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> PHP library mimics the architecture of the underlying API. This is two operations (which means it requires two network requests to the remote host), and so we must perform two operations.</p>
<p>The <code>createContainer()</code> call actually creates the new container on the cloud's Object Storage. The second call connects to the remote object storage, and gets the new container. The container that is returned will have some additional information, such as the amount of space it takes up on the remote storage, and the access control rules for that container. All of this information will be available on the <code>$container</code> instance.</p>
<p>Our <code>$container</code> instance is an instance of <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_container.html" title="A container in an ObjectStorage.">HPCloud::Storage::ObjectStorage::Container</a>. This object can be used not only to find out about a container, but also to get information about the objects in that container.</p>
<p>Now that we have a <code>Container</code>, we can add an object.</p>
<h3>The Container in a Nutshell</h3>
<p>(Yes, we realize the irony of that title.)</p>
<p>A <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_container.html" title="A container in an ObjectStorage.">HPCloud::Storage::ObjectStorage::Container</a> instance is responsible for the following:</p>
<ul>
<li>Accessing information about the container</li>
<li>Creating, saving, deleting, and listing objects in the container</li>
<li>Providing path-like traversal of objects</li>
<li>Copying objects across containers</li>
<li>Interacting with CDN objects (advanced)</li>
<li>Loading a lightweight representation of an object without fetching the entire object (more on this later).</li>
</ul>
<p>Among the features of a Container, it can act like an <code>Iterator</code> and is <code>Countable</code>. That means you can loop through a Container in a <code>foreach</code> loop and also use <code>count($container)</code> to find out the number of objects in a Container.</p>
<h2>Step 6: Storing an Object</h2>
<p>Now we are ready to create an object, and then store it in our container.</p>
<p>Before diving too deeply, it is important to point out a detail: When working with a remote data storage service, we are typically working with a local copy and a remote copy. If our code isn't constructed correctly, it is possible for these two to get out of sync.</p>
<p>Earlier, we created a container directly on the remote side, and then featched the container. As we create an object, we are going to do the opposite: We will create a local object, and then save it to the remote storage. Later, we will fetch the remote object.</p>
<div class="fragment"><pre class="fragment">&lt;?php
<a class="code" href="oo-tutorial-code_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = <span class="stringliteral">&#39;hello.txt&#39;</span>;
<a class="code" href="oo-tutorial-code_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a> = <span class="stringliteral">&#39;Hello World&#39;</span>;
<a class="code" href="oo-tutorial-code_8php.html#a958cf7aca45cea5359ba0fa80ee2f2c1">$mime</a> = <span class="stringliteral">&#39;text/plain&#39;</span>;

<a class="code" href="oo-tutorial-code_8php.html#a9d7c6bf0cf7ea5a9208c10649a167103">$localObject</a> = <span class="keyword">new</span> Object($name, <a class="code" href="oo-tutorial-code_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a>, <a class="code" href="oo-tutorial-code_8php.html#a958cf7aca45cea5359ba0fa80ee2f2c1">$mime</a>);
<a class="code" href="oo-tutorial-code_8php.html#ab97dd40df90f4ce6f0fce9091e7c7872">$container</a>-&gt;save(<a class="code" href="oo-tutorial-code_8php.html#a9d7c6bf0cf7ea5a9208c10649a167103">$localObject</a>);
?&gt;
</pre></div><p>In the code above, we create <code>$localObject</code> with a <code>$name</code>, some <code>$content</code>, and a <code>$mime</code> type. Strictly speaking, only <code>$name</code> is required.</p>
<p>The <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_object.html" title="An object for ObjectStorage.">HPCloud::Storage::ObjectStorage::Object</a> class is used primarily to describe a locally created object. Once we have our new <code>Object</code>, we can save it remotely using the <code>save()</code> method on our <code>$container</code> object. This will push the object to the remote object storage service.</p>
<p>While we can continue manipulating <code>$localObject</code>, we are working with the local version, not the latest version of what's on the server. This is fine if what we are doing is writing more data. However, when examining the content of the object, remember that we are working with the local copy, and its properties may differ from the remote copy's.</p>
<h3>What if I call save() twice with the same Object?</h3>
<p>Objects, like files on a file system, are referenced by name. Any time you <code>save()</code> an object, it will be pushed to the remote object storage server, which will happily replace the old content with your newly submitted content.</p>
<p>Next let's turn to loading objects from the remote object storage.</p>
<h3>The Object in a Nutshell</h3>
<p>The <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_object.html" title="An object for ObjectStorage.">HPCloud::Storage::ObjectStorage::Object</a> instances are used for:</p>
<ul>
<li>Creating a local object to be stored remotely</li>
</ul>
<p>This class is also the base class for the <code>RemoteObject</code> class that we will look at later.</p>
<p>The API is generally constructed so that a developer needn't worry about the differences between an <code>Object</code> and a <code>RemoteObject</code>. But in all but the edgiest of edge cases, you would only create an instance of <code>Object</code>, never of <code>RemoteObject</code>.</p>
<h2>Step 7: Loading an Object</h2>
<p>Containers not only provide the methods for saving objects, but also for loading objects. Thus, we can fetch the object that we just created:</p>
<div class="fragment"><pre class="fragment">&lt;?php
<a class="code" href="oo-tutorial-code_8php.html#a52123b83a1952a68c5513e47d59ec4a6">$object</a> = <a class="code" href="oo-tutorial-code_8php.html#ab97dd40df90f4ce6f0fce9091e7c7872">$container</a>-&gt;object(<span class="stringliteral">&#39;hello.txt&#39;</span>);

printf(<span class="stringliteral">&quot;Name: %s \n&quot;</span>, $object-&gt;name());
printf(<span class="stringliteral">&quot;Size: %d \n&quot;</span>, $object-&gt;contentLength());
printf(<span class="stringliteral">&quot;Type: %s \n&quot;</span>, $object-&gt;contentType());
print $object-&gt;content() . <a class="code" href="streams-tutorial-example_8php.html#ad50e7caf4a5d9866dc147787a5928678">PHP_EOL</a>;
?&gt;
</pre></div><p>The <code>$object</code> variable now references an instance of a <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_remote_object.html" title="A representation of an object stored in remote Object Storage.">HPCloud::Storage::ObjectStorage::RemoteObject</a> that contains the entire object. <code>RemoteObject</code> represents an object that was loaded from the remote server. Along with providing the features of the <code>Object</code> class we saw earlier, it also provides numerous optimizations for working over the network.</p>
<p>Now that we have the object, we print out several pieces of information -- <code>name()</code>, <code>size()</code>, amd <code>type()</code>. Then, using <code>content()</code>, we fetch the content of the object.</p>
<h3>Lazily Loading an Object</h3>
<p>The method we used above to fetch the object is perfect for our needs. It pulls the entire object down in a single request. But imagine this scenario: Our object storage has large media files, and we don't know at loading time whether or not we need to access the body content, or just the other data about the object.</p>
<p>It would be a time-consuming task to download the entire body of a large media file if we don't actually use the body. On the other hand, from an API standpoint it is great to be able to pass around a single object, and not require the application to know whether or not the body has been retrieved.</p>
<p>The <code>RemoteObject</code> solves this problem using a technique known as "lazy
loading". That is, it can pull some of the data right away, but defer fetching the rest of the data until that data is actually needed.</p>
<p>To fetch an object this way, we can just swap out one line in the example above:</p>
<div class="fragment"><pre class="fragment">&lt;?php
$object = <a class="code" href="oo-tutorial-code_8php.html#ab97dd40df90f4ce6f0fce9091e7c7872">$container</a>-&gt;proxyObject(<span class="stringliteral">&#39;hello.txt&#39;</span>);

printf(<span class="stringliteral">&quot;Name: %s \n&quot;</span>, $object-&gt;name());
printf(<span class="stringliteral">&quot;Size: %d \n&quot;</span>, $object-&gt;contentLength());
printf(<span class="stringliteral">&quot;Type: %s \n&quot;</span>, $object-&gt;contentType());
print $object-&gt;content() . <a class="code" href="streams-tutorial-example_8php.html#ad50e7caf4a5d9866dc147787a5928678">PHP_EOL</a>;
?&gt;
</pre></div><p>Instead of using <code>object()</code>, we now use <code>proxyObject()</code>. This method immediately loads the core data about the remote object, but defers fetching the content until the content is requested.</p>
<p>In the example above, then, one network request is issued by <code>proxyObject()</code>, but another is initiated when <code>$object-&gt;content()</code> is called.</p>
<h3>The RemoteObject in a Nutshell</h3>
<p>Instances of a <a class="el" href="class_h_p_cloud_1_1_storage_1_1_object_storage_1_1_remote_object.html" title="A representation of an object stored in remote Object Storage.">HPCloud::Storage::ObjectStorage::RemoteObject</a> offer the following features:</p>
<ul>
<li>Access to an object stored on the remote object storage</li>
<li>A proxying mechanism for lazily loading objects</li>
<li>Support for loading via CDN (advanced)</li>
<li>A stream-based API for using stream and file-based PHP functions</li>
<li>Automatic tempfile-based caching for large objects (using <code>php://temp</code>).</li>
</ul>
<p><code>RemoteObject</code> instances can be updated and then passed to <code>Container::save()</code> to update the copy on the server, too.</p>
<h2>Summary</h2>
<p>At this point we have created a very basic script that connects to <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> and works with object storage. Clearly, this only scratches the surface of what the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> PHP library does. But hopefully this is enough to get you started with the library.</p>
<p>The entire library is well documented, and the documentation is <a href="https://github.com/hpcloud">available online</a>. You can also build a local copy by installing <a href="http://www.stack.nl/~dimitri/doxygen">doxygen</a> (if you haven't already) and running <code>make docs</code> in the root of the <a class="el" href="namespace_h_p_cloud.html" title="The HPCloud PHP library.">HPCloud</a> PHP project. This will place the generated documents in <code>docs/api/html</code>.</p>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="oo-tutorial-code_8php.html">oo-tutorial-code.php</a> </dd></dl>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Fri Mar 16 2012 16:57:43 for HPCloud-PHP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
